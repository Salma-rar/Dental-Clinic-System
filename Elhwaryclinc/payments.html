<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹ - Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø³Ù†Ø§Ù†</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header>
        <h1><i class="fas fa-money-bill-wave"></i> Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹</h1>
    </header>
    
    <nav>
        <ul>
            <li><a href="index.html"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
            <li><a href="patients.html"><i class="fas fa-user-injured"></i> Ø§Ù„Ù…Ø±Ø¶Ù‰</a></li>
            <li><a href="appointments.html"><i class="fas fa-calendar-alt"></i> Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</a></li>
            <li><a class="active" href="payments.html"><i class="fas fa-money-bill-wave"></i> Ø§Ù„Ø¯ÙØ¹</a></li>
            <li><a href="services.html"><i class="fas fa-teeth"></i> Ø§Ù„Ø®Ø¯Ù…Ø§Øª</a></li>
        </ul>
    </nav>
    
    <main>
        <div class="revenue-summary" style="margin-top:20px; padding:10px; border:1px solid #ccc; border-radius:8px; background:#f9f9f9;">
    <p>ğŸ“… Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ: <span id="dailyRevenue">0 Ø¬</span></p>
    <p>ğŸ“† Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ: <span id="weeklyRevenue">0 Ø¬</span></p>
    <p>ğŸ“Š Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ: <span id="monthlyRevenue">0 Ø¬</span></p>
</div>

        <section class="payment-form">
            <h2><i class="fas fa-plus-circle"></i> ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
            <form id="paymentForm">
                <div class="form-row">
                    <div class="form-group">
                        <select id="paymentPatient" required>
                            <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±ÙŠØ¶</option>
                        </select>
                        <label for="paymentPatient">Ø§Ù„Ù…Ø±ÙŠØ¶</label>
                    </div>
                    
                    <div class="form-group">
                        <select id="paymentService" required>
                            <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø©</option>
                        </select>
                        <label for="paymentService">Ø§Ù„Ø®Ø¯Ù…Ø©</label>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <input type="number" id="paymentAmount" required placeholder=" ">
                        <label for="paymentAmount">Ø§Ù„Ù…Ø¨Ù„Øº (Ø¬Ù†ÙŠØ©)</label>
                    </div>
                    
                    <div class="form-group">
                        <select id="paymentMethod" required>
                            <option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
                            <option value="card">Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†</option>
                            <option value="transfer">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</option>
                            <option value="mobile">Ù…Ø­ÙØ¸Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</option>
                        </select>
                        <label for="paymentMethod">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
                    </div>
                </div>
                
                <div class="form-group">
                    <textarea id="paymentNotes" rows="2" placeholder=" "></textarea>
                    <label for="paymentNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                </div>
                
                <button type="submit"><i class="fas fa-save"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø©</button>
                <div id="paymentMessage" class="confirmation-message"></div>
            </form>
        </section>
        
        <section class="payment-summary">
            <div class="summary-card">
                <h3><i class="fas fa-chart-pie"></i> Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</h3>
                <div class="summary-items">
                    <div class="summary-item">
                        <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª:</span>
                        <span id="totalPayments">0 Ø¬</span>
                    </div>
                    <div class="summary-item">
                        <span>Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ù†Ù‚Ø¯Ø§Ù‹:</span>
                        <span id="cashPayments">0 Ø¬</span>
                    </div>
                    <div class="summary-item">
                        <span>Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Ù‹:</span>
                        <span id="electronicPayments">0 Ø¬</span>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="payment-history">
            <h2><i class="fas fa-history"></i> Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª <small>(${clinicData.payments.length} Ø¹Ù…Ù„ÙŠØ©)</small></h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ø§Ù„Ù…Ø±ÙŠØ¶</th>
                            <th>Ø§Ù„Ø®Ø¯Ù…Ø©</th>
                            <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                            <th>Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©</th>
                            <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="paymentsTable"></tbody>
                </table>
            </div>
        </section>
    </main>

   <script src="app.js"></script>
<script>
    const paymentForm = document.getElementById('paymentForm');
    const paymentsTable = document.getElementById('paymentsTable');
    const paymentMessage = document.getElementById('paymentMessage');

    function populatePaymentSelects() {
        const patientSelect = document.getElementById('paymentPatient');
        const serviceSelect = document.getElementById('paymentService');

        patientSelect.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±ÙŠØ¶</option>';
        serviceSelect.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø©</option>';

        clinicData.patients.forEach(patient => {
            const option = document.createElement('option');
            option.value = patient.name;
            option.textContent = patient.name;
            patientSelect.appendChild(option);
        });

        clinicData.services.forEach(service => {
            const option = document.createElement('option');
            option.value = service.name;
            option.textContent = `${service.name} (${service.price} Ø¬)`;
            serviceSelect.appendChild(option);
        });
    }

    function displayPayments() {
        paymentsTable.innerHTML = '';

        if (clinicData.payments.length === 0) {
            const row = document.createElement('tr');
            row.innerHTML = `<td colspan="7" class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯ÙÙˆØ¹Ø§Øª Ù…Ø³Ø¬Ù„Ø©</td>`;
            paymentsTable.appendChild(row);
            updatePaymentSummary();
            return;
        }

        paymentForm.addEventListener('submit', (e) => {
    e.preventDefault();
    
    const newPayment = {
        patient: document.getElementById('paymentPatient').value,
        service: document.getElementById('paymentService').value,
        amount: parseFloat(document.getElementById('paymentAmount').value),
        method: document.getElementById('paymentMethod').value,
        date: new Date().toISOString()
    };
    
    clinicData.payments.push(newPayment);
    saveData();
    paymentForm.reset();
    displayPayments();
    
    // Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    localStorage.setItem('clinicData', JSON.stringify(clinicData));
});
        clinicData.payments.forEach((payment, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${new Date(payment.date).toLocaleDateString('ar-EG')}</td>
                <td>${payment.patient}</td>
                <td>${payment.service}</td>
                <td>${payment.amount} Ø¬</td>
                <td>${getPaymentMethodName(payment.method)}</td>
                <td>${payment.notes || '-'}</td>
                <td>
                    <button class="delete-payment" data-id="${index}">
                        <i class="fas fa-trash"></i> Ø­Ø°Ù
                    </button>
                </td>
            `;
            paymentsTable.appendChild(row);
        });

        // Ø­Ø°Ù Ø¯ÙØ¹Ø©
        document.querySelectorAll('.delete-payment').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const id = e.target.closest('button').getAttribute('data-id');
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙØ¹Ø©ØŸ')) {
                    clinicData.payments.splice(id, 1);
                    saveData();
                    displayPayments();
                    updatePaymentSummary();
                    showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯ÙØ¹Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }
            });
        });

        updatePaymentSummary();
    }

    function updatePaymentSummary() {
        const total = clinicData.payments.reduce((sum, p) => sum + p.amount, 0);
        const cash = clinicData.payments
            .filter(p => p.method === 'cash')
            .reduce((sum, p) => sum + p.amount, 0);
        const electronic = total - cash;

        document.getElementById('totalPayments').textContent = `${total} Ø¬`;
        document.getElementById('cashPayments').textContent = `${cash} Ø¬`;
        document.getElementById('electronicPayments').textContent = `${electronic} Ø¬`;
    }

    paymentForm.addEventListener('submit', (e) => {
        e.preventDefault();

        const newPayment = {
            patient: document.getElementById('paymentPatient').value,
            service: document.getElementById('paymentService').value.split(' (')[0],
            amount: parseFloat(document.getElementById('paymentAmount').value),
            method: document.getElementById('paymentMethod').value,
            notes: document.getElementById('paymentNotes').value,
            date: new Date().toISOString()
        };

        clinicData.payments.push(newPayment);
        addPaymentToRevenue(newPayment.amount);
        saveData();
        paymentForm.reset();
        displayPayments();
        showMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
    });

    document.getElementById('paymentService').addEventListener('change', function() {
        const serviceName = this.value.split(' (')[0];
        const service = clinicData.services.find(s => s.name === serviceName);
        if (service) {
            document.getElementById('paymentAmount').value = service.price;
        }
    });

    function showMessage(text, type) {
        paymentMessage.textContent = text;
        paymentMessage.className = `confirmation-message ${type}`;
        paymentMessage.style.display = 'block';
        setTimeout(() => {
            paymentMessage.style.display = 'none';
        }, 3000);
    }

    populatePaymentSelects();
    displayPayments();
</script>